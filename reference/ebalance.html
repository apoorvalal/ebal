<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function implements entropy balancing, a data preprocessing
procedure that allows users to reweight a dataset. The preprocessing
is based on a maximum entropy reweighting scheme that assigns weights
to each unit such that the covariate distributions in the reweighted
data satisfy a set of moment conditions specified by the researcher.
This can be useful to balance covariate distributions in
observational studies with a binary treatment where the control group
data can be reweighted to match the covariate moments in the
treatment group. Entropy balancing can also be used to reweight a
survey sample to known characteristics from a target population. The
weights that result from entropy balancing can be passed to
regression or other models to subsequently analyze the reweighted
data.
By default, ebalance reweights the covariate distributions from a
control group to match target moments that are computed from a
treatment group such that the reweighted data can be used to analyze
the average treatment effect on the treated."><title>Primary Function for Entropy Balancing — ebalance • ebal</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.5/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.5/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.5/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Primary Function for Entropy Balancing — ebalance"><meta property="og:description" content="This function implements entropy balancing, a data preprocessing
procedure that allows users to reweight a dataset. The preprocessing
is based on a maximum entropy reweighting scheme that assigns weights
to each unit such that the covariate distributions in the reweighted
data satisfy a set of moment conditions specified by the researcher.
This can be useful to balance covariate distributions in
observational studies with a binary treatment where the control group
data can be reweighted to match the covariate moments in the
treatment group. Entropy balancing can also be used to reweight a
survey sample to known characteristics from a target population. The
weights that result from entropy balancing can be passed to
regression or other models to subsequently analyze the reweighted
data.
By default, ebalance reweights the covariate distributions from a
control group to match target moments that are computed from a
treatment group such that the reweighted data can be used to analyze
the average treatment effect on the treated."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ebal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/performance_comparisons.html">Entropy Balancing Performance Considerations</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Primary Function for Entropy Balancing</h1>
      
      <div class="d-none name"><code>ebalance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements entropy balancing, a data preprocessing
procedure that allows users to reweight a dataset. The preprocessing
is based on a maximum entropy reweighting scheme that assigns weights
to each unit such that the covariate distributions in the reweighted
data satisfy a set of moment conditions specified by the researcher.
This can be useful to balance covariate distributions in
observational studies with a binary treatment where the control group
data can be reweighted to match the covariate moments in the
treatment group. Entropy balancing can also be used to reweight a
survey sample to known characteristics from a target population. The
weights that result from entropy balancing can be passed to
regression or other models to subsequently analyze the reweighted
data.
By default, ebalance reweights the covariate distributions from a
control group to match target moments that are computed from a
treatment group such that the reweighted data can be used to analyze
the average treatment effect on the treated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ebalance</span><span class="op">(</span></span>
<span>  <span class="va">Treatment</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  base.weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  norm.constant <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coefs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max.iterations <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  constraint.tolerance <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  print.level <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GaussNewton"</span>, <span class="st">"AutoDiff"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Treatment</dt>
<dd><p>A vector indicating the observations which are in
the data group that should be reweighted (i.e. the control group) and
those which are in the data group that should be used to compute the
target moments (i.e. the treatment group). This can either be a
logical vector or a real vector where 0 denotes control observations
and 1 denotes treatment observations. By default the target moments
are computed using the data from all treatment observations.</p></dd>


<dt>X</dt>
<dd><p>A matrix containing the variables that the researchers wants
to include in the reweighting. To adjust the means of the covariates,
the raw covariates can be included. To adjust the variances of the
covariates, squared terms of the raw covariates can be included. To
adjust co-moments, interaction terms can be included. All columns of
this matrix must have positive variance and the matrix must be
invertible. No missing data is allowed.</p></dd>


<dt>base.weight</dt>
<dd><p>An optional vector of base weights for the
maximum entropy reweighting (one weight for each control unit). The
default is uniform base weights.</p></dd>


<dt>norm.constant</dt>
<dd><p>An optional normalizing constant. By default the
weights are normalized such that the sum of the weights for the
reweighted control group match the number of observations in the
treatment group.</p></dd>


<dt>coefs</dt>
<dd><p>An optional vector of model coefficients to start the
reweighting.</p></dd>


<dt>max.iterations</dt>
<dd><p>Maximum number of iterations that will be run
when attempting to reweight the data.</p></dd>


<dt>constraint.tolerance</dt>
<dd><p>This is the tolerance level used by
ebalance to decide if the moments in the reweighted data are equal to
the target moments.</p></dd>


<dt>print.level</dt>
<dd><p>Controls the level of printing: 0 (normal
printing), 2 (detailed), and 3 (very detailed).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An list object of class ebalance with the following elements:</p>
<dl><dt>target.margins</dt>
<dd><p>A vector that contains the target moments coded from the covariate distributions of the treatment group.</p></dd>
<dt>co.xdata</dt>
<dd><p>A matrix that contains the covariate data from the control group.</p></dd>
<dt>w</dt>
<dd><p>A vector that contains the control group weights assigned by entropy balancing.</p></dd>
<dt>coefs</dt>
<dd><p>A vector that contains coefficients from the reweighting algorithm.</p></dd>
<dt>maxdiff</dt>
<dd><p>A scalar that contains the maximum deviation between the moments of the reweighted data and the target moments.</p></dd>
<dt>constraint.tolerance</dt>
<dd><p>The tolerance level used for the balance constraints.</p></dd>
<dt>base.weight</dt>
<dd><p>The base weight used.</p></dd>
<dt>print.level</dt>
<dd><p>The print level used.</p></dd>
<dt>converged</dt>
<dd><p>Logical flag if algorithm converged within tolerance.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hainmueller, J. (2012) 'Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies', Political Analysis (Winter 2012) 20 (1): 25–46.</p>
<p>Zaslavsky, A. (1988), 'Representing local reweighting area adjustments by of households', Survey Methodology 14(2), 265–288.</p>
<p>Ireland, C. and Kullback, S. (1968), 'Contingency tables with given marginals', Biometrika 55, 179–188.</p>
<p>Kullback, S. (1959), Information Theory and Statistics, Wiley, NY.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">treatment</span>  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span>          <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>,<span class="fl">.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># entropy balancing</span></span></span>
<span class="r-in"><span><span class="va">eb.out</span>  <span class="op">=</span> <span class="fu">ebalance</span><span class="op">(</span>Treatment<span class="op">=</span><span class="va">treatment</span>, X<span class="op">=</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># means in treatment group data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">treatment</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1     x2     x3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2545 0.3545 0.5502 </span>
<span class="r-in"><span><span class="co"># means in reweighted control group data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">treatment</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span>,<span class="fl">2</span>,<span class="va">weighted.mean</span>,w<span class="op">=</span><span class="va">eb.out</span><span class="op">$</span><span class="va">w</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     x1     x2     x3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2533 0.3572 0.5554 </span>
<span class="r-in"><span><span class="co"># means in raw data control group data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">treatment</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       x1       x2       x3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.39115 -0.19742  0.07657 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Jens Hainmueller, Apoorva Lal.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

